<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>生命週期 | 葡萄哥的Blog</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="logo.jpeg">
    <meta name="description" content="葡萄哥的學習記錄">
    
    <link rel="preload" href="/blog/assets/css/0.styles.cea178bd.css" as="style"><link rel="preload" href="/blog/assets/js/app.aecd4755.js" as="script"><link rel="preload" href="/blog/assets/js/2.8521d118.js" as="script"><link rel="preload" href="/blog/assets/js/10.366d327b.js" as="script"><link rel="prefetch" href="/blog/assets/js/11.88b7ce57.js"><link rel="prefetch" href="/blog/assets/js/12.db80494d.js"><link rel="prefetch" href="/blog/assets/js/13.276a7f8a.js"><link rel="prefetch" href="/blog/assets/js/14.2be283c5.js"><link rel="prefetch" href="/blog/assets/js/15.d88e0f9f.js"><link rel="prefetch" href="/blog/assets/js/16.c9ba40c9.js"><link rel="prefetch" href="/blog/assets/js/17.afe8c82a.js"><link rel="prefetch" href="/blog/assets/js/18.dd21db60.js"><link rel="prefetch" href="/blog/assets/js/19.b68e4d10.js"><link rel="prefetch" href="/blog/assets/js/20.6f9bc09e.js"><link rel="prefetch" href="/blog/assets/js/21.ee8434e1.js"><link rel="prefetch" href="/blog/assets/js/22.9aa269d3.js"><link rel="prefetch" href="/blog/assets/js/23.b543e6d4.js"><link rel="prefetch" href="/blog/assets/js/24.3fd15c49.js"><link rel="prefetch" href="/blog/assets/js/25.4c73d932.js"><link rel="prefetch" href="/blog/assets/js/3.7672de95.js"><link rel="prefetch" href="/blog/assets/js/4.11f76de3.js"><link rel="prefetch" href="/blog/assets/js/5.a37c3396.js"><link rel="prefetch" href="/blog/assets/js/6.3b29df05.js"><link rel="prefetch" href="/blog/assets/js/7.215f472f.js"><link rel="prefetch" href="/blog/assets/js/8.cb3a702d.js"><link rel="prefetch" href="/blog/assets/js/9.47a51e61.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.cea178bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">葡萄哥的Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/learning/" class="nav-link router-link-active">
  學習
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="葡萄 JavaScript 博客" class="dropdown-title"><span class="title">葡萄 JavaScript 博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="葡萄 JavaScript 博客" class="mobile-dropdown-title"><span class="title">葡萄 JavaScript 博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Putaoge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/learning/" class="nav-link router-link-active">
  學習
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="葡萄 JavaScript 博客" class="dropdown-title"><span class="title">葡萄 JavaScript 博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="葡萄 JavaScript 博客" class="mobile-dropdown-title"><span class="title">葡萄 JavaScript 博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/Putaoge" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>瀏覽器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React-初學</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/1.%E9%96%8B%E5%A7%8B%E5%AD%B8%E7%BF%92React/" class="sidebar-link">1. 開始學習React</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/2.Class-Component/" class="sidebar-link">2. Class-Component</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/3.%E4%BA%8B%E4%BB%B6%E8%99%95%E7%90%86/" class="sidebar-link">3. 事件處理</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/4.props%E8%A3%9C%E5%85%85/" class="sidebar-link">4. props補充</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/5.ref/" class="sidebar-link">5. ref</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/6.%E6%95%B8%E6%93%9A%E5%82%B3%E9%81%9E/" class="sidebar-link">6. 數據傳遞</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/7.Composition/" class="sidebar-link">7. Composition</a></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/" aria-current="page" class="active sidebar-link">8. 生命週期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#mounting-元件被安裝時" class="sidebar-link">Mounting 元件被安裝時</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#updating-元件被更新時" class="sidebar-link">Updating 元件被更新時</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#unmounting-元件被移除時" class="sidebar-link">Unmounting 元件被移除時</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#常用的生命周期方法" class="sidebar-link">常用的生命周期方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#render" class="sidebar-link">render()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#constructor" class="sidebar-link">constructor()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#componentdidmount" class="sidebar-link">componentDidMount()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#componentdidupdate" class="sidebar-link">componentDidUpdate()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#componentwillunmount" class="sidebar-link">componentWillUnmount()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#不常使用的生命週期方法" class="sidebar-link">不常使用的生命週期方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#shouldcomponentupdate" class="sidebar-link">shouldComponentUpdate()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#static-getderivedstatefromprops" class="sidebar-link">static getDerivedStateFromProps()</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#getsnapshotbeforeupdate" class="sidebar-link">getSnapshotBeforeUpdate()</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#實例" class="sidebar-link">實例:</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#mounting-元件被安裝時-2" class="sidebar-link">Mounting 元件被安裝時</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#updating-元件被更新時-2" class="sidebar-link">Updating 元件被更新時</a></li><li class="sidebar-sub-header"><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/8.%E7%94%9F%E5%91%BD%E9%80%B1%E6%9C%9F/#unmounting-元件被移除時-2" class="sidebar-link">Unmounting 元件被移除時</a></li></ul></li></ul></li><li><a href="/blog/learning/React-%E5%88%9D%E5%AD%B8/9.Function-Component/" class="sidebar-link">9.Function-Component</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="生命週期"><a href="#生命週期" class="header-anchor">#</a> 生命週期</h1> <p>每一個 component 都有數個 「生命週期方法」，你可以使用這個生命週期表作為速查表:
<img src="/blog/assets/img/lifecycleDiagram.083b743c.png" alt="lifeCircle"></p> <p>以下，常用的生命週期方法將會以粗體表達。其餘的生命週期方法則相對較少</p> <h2 id="mounting-元件被安裝時"><a href="#mounting-元件被安裝時" class="header-anchor">#</a> Mounting 元件被安裝時</h2> <p>當一個 component 的 instance 被建立且加入 DOM 中時，其生命週期將會依照下列的順序呼叫這些方法：</p> <ul><li><strong><code>constructor()</code></strong></li> <li>static getDerivedStateFromProps()</li> <li><strong><code>render()</code></strong></li> <li><strong><code>componentDidMount()</code></strong></li></ul> <h2 id="updating-元件被更新時"><a href="#updating-元件被更新時" class="header-anchor">#</a> Updating 元件被更新時</h2> <p>當 prop 或 state 有變化時，就會產生更新。當一個 component 被重新 render 時，其生命週期將會依照下列的順序呼叫這些方法：</p> <ul><li>static getDerivedStateFromProps()</li> <li>shouldComponentUpdate()</li> <li><strong><code>render()</code></strong></li> <li>getSnapshotBeforeUpdate()</li> <li><strong><code>componentDidUpdate()</code></strong></li></ul> <h2 id="unmounting-元件被移除時"><a href="#unmounting-元件被移除時" class="header-anchor">#</a> Unmounting 元件被移除時</h2> <p>當一個 component 被從 DOM 中移除時，僅有這個方法將會被呼叫：</p> <ul><li><strong><code>componentWillUnmount()</code></strong></li></ul> <h2 id="常用的生命周期方法"><a href="#常用的生命周期方法" class="header-anchor">#</a> 常用的生命周期方法</h2> <p>此段落將會介紹你在建立 React component 時最可能會使用到的幾種方法。</p> <h3 id="render"><a href="#render" class="header-anchor">#</a> render()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>render()</code> 是 class component 中唯一必要的方法。</p> <p>當 render 被呼叫時，它將會檢視 <code>this.props</code> 和 <code>this.state</code> 中的變化，並回傳以下類別之一：</p> <ul><li><strong><code>React 元素</code></strong> 。通常通過 JSX 創建。例如，<code>&lt;div /&gt;</code> 會被 React 渲染為 DOM 節點，<code>&lt;MyComponent /&gt;</code> 會被 React 渲染為自定義元件，無論是 <code>&lt;div /&gt;</code> 還是 <code>&lt;MyComponent /&gt;</code> 均為 React 元素。</li> <li><strong><code>陣列或 fragments</code></strong> 。使得 render 方法可以返回多個元素。欲了解更多詳細信息，請參閱 <a href="https://zh-hant.reactjs.org/docs/fragments.html" target="_blank" rel="noopener noreferrer">fragments<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 文檔。</li> <li><strong><code>Portals</code></strong> 。可以渲染子節點到不同的 DOM 子樹中。欲了解更多詳細信息，請參閱有關 <a href="https://zh-hant.reactjs.org/docs/portals.html" target="_blank" rel="noopener noreferrer">portals<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的文檔。</li> <li><strong><code>String或Number類型</code></strong> 。它們在 DOM 中會被渲染為文本節點。</li> <li><strong><code>Boolean類型或 null</code></strong> 。什麼都不渲染。 （主要用於支持返回 test &amp;&amp; <code>&lt;Child /&gt;</code> 的模式，其中 test 為布爾類型。)</li></ul> <p><code>render()</code> function 應該是 pure 的，這表示：它並不會改變 component 的 state，它在每次呼叫時都會回傳同樣的結果，它並不會直接和瀏覽器有所互動。</p> <p>如果你需要和瀏覽器互動，請在 <code>componentDidMount()</code> 或其他的生命週期方法內執行你的程式。將 <code>render()</code> 維持在 pure 的狀態有助於你對 component 的理解。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>若 shouldComponentUpdate() 回傳的值為 false 的話，render()將不會被呼叫。</p></div> <h3 id="constructor"><a href="#constructor" class="header-anchor">#</a> constructor()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="如果你沒有初始化-state-也不綁定方法的話-你的-react-component-就不需要-constructor。"><a href="#如果你沒有初始化-state-也不綁定方法的話-你的-react-component-就不需要-constructor。" class="header-anchor">#</a> 如果你沒有初始化 state 也不綁定方法的話，你的 React component 就不需要 constructor。</h5> <p>一個 React component 的 constructor 會在其被 mount 之前被呼叫。當你為一個 <code>React.Component</code> subclass 建立 constructor 時，你應該在其他任何宣告之前呼叫 <code>super(props)</code>。否則，<code>this.props</code> 在 constructor 中的值會出現 undefined 的 bug。</p> <p>通常在 React 中 constructor 只會有兩種用途：</p> <ul><li>透過指定一個 <code>this.state</code> 物件來初始化內部 state。</li> <li>為 event handler 方法綁定 instance。</li></ul> <p>請<strong>不要在 constructor() 中呼叫 setState()</strong>。如果你的 component 需要使用內部 state，請在 constructor 中<strong>將其最初的 state 指定為 this.state</strong>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 不要在這裡呼叫 this.setState()！</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Constructor 是唯一一個你應該直接指定 <code>this.state</code> 的地方。在所有其他的方法中，你則需要使用 <code>this.setState()</code>。</p> <p>請避免在 constructor 中產生任何 side effect 或 subscription。如果你需要它們的話，請使用 <code>componentDidMount()</code>。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p><strong>請避免複製 prop 到 state 之中！這是一個很常見的錯誤：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 請不要這樣做！</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> props<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>這樣做的問題是：一來這毫無必要（你可以直接用 <code>this.props.color</code>），二來這會產生 bug（任何改變對 <code>color</code> prop 所產生的更新都不會出現在 state 中）。</p> <p><strong>請在只有在你刻意要忽略 prop 更新的情況下才使用這個模式。</strong> 在這種情況下，比較合理的做法是將 prop 重新命名為 <code>initialColor</code> 或 <code>defaultColor</code>。如此一來，你可以在必要的情況下透過<a href="https://zh-hant.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html#recommendation-fully-uncontrolled-component-with-a-key" target="_blank" rel="noopener noreferrer">修改一個 component 的 key<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 來強迫它「重置」其初始的 state。</p> <p>若想知道如何處理 state 依賴 prop 的情況，請參考我們 <a href="https://zh-hant.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="noopener noreferrer">關於避免 derived state 的部落格文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <h3 id="componentdidmount"><a href="#componentdidmount" class="header-anchor">#</a> componentDidMount()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在一個 component 被 mount（加入 DOM tree 中）後，<code>componentDidMount()</code> 會馬上被呼叫。需要 DOM node 的初始化應該寫在這個方法裡面。如果你需要從遠端終端點（remote endpoint）請求資料的話, 此處非常適合進行實例化網路請求（network request）。</p> <p>這個方法適合設立任何 subscription。設立完 subscription 後，別忘了在 <code>componentWillUnmount()</code> 內取消 subscription。</p> <p>你<strong>可以馬上在 componentDidMount() 內呼叫 setState()</strong>。這會觸發一次額外的 render，但這會在瀏覽器更新螢幕之前發生。在這個情況下，即使 <code>render()</code> 被呼叫兩次，這確保使用者不會看見這兩次 render 中過渡時期的 state。請謹慎使用這個模式，因為這經常會導致效能問題。在大多數情況下，你應該能夠在 <code>constructor()</code> 內指定初始 state 的值。不過，在某些情況下，像是在使用 modal 和 tooltip 的時候，你所 render 的 component 若是依賴某個 DOM node 的大小或位置時，這種模式有時候可能是有必要的。</p> <h3 id="componentdidupdate"><a href="#componentdidupdate" class="header-anchor">#</a> componentDidUpdate()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>componentDidUpdate()</code> 會在更新後馬上被呼叫。這個方法並不會在初次 render 時被呼叫。</p> <p>在 component 更新之後，可以在此處對 DOM 進行運作。此處也適合做網路請求，如果你有比較目前的 prop 和之前的 prop 的話（如果 prop 沒有改變的話，網路請求可能並非必要）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 常見用法（別忘了比較 prop）：</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userID <span class="token operator">!==</span> prevProps<span class="token punctuation">.</span>userID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>userID<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>使用這個函數時有一個很重要的事情: <strong>只要任何一個props/state被設定(assign)，就會重新進入Update週期，導致此函數再次被執行</strong>。為什麼這件事很重要呢? 假設今天有一個props叫A，一個state叫B，我們希望A被改變為true時，給予B一個值:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token constant">A</span><span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token constant">B</span><span class="token operator">:</span> <span class="token string">&quot;A是真的!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>實際執行你會發現，react在A第一次被設定後，<strong>開始瘋狂的重複設定B</strong>。然後你的網頁就死掉了。</p> <p>為什麼會這樣? 因為你在componentDidUpdate中設定state或props時，又會進入re-render的update生命週期，也就是進入像這樣的無限循環:</p> <div class="language- extra-class"><pre><code>偵測到A被設定-&gt; 在componentDidUpdate中設定B -&gt; 偵測到B被設定 -&gt; 在componentDidUpdate中設定B -&gt; 偵測到B被設定 -&gt; ...
</code></pre></div><p>如果要避免無限循環，就要改成這樣:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token constant">A</span><span class="token operator">===</span><span class="token boolean">true</span> <span class="token operator">&amp;&amp;</span> prevProps<span class="token punctuation">.</span><span class="token constant">A</span> <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token constant">A</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token constant">B</span><span class="token operator">:</span> <span class="token string">&quot;A是真的!&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language- extra-class"><pre><code>偵測到A被設定-&gt; 在componentDidUpdate中設定B -&gt; 偵測到B被設定 -&gt; 發現A的值和之前一樣 -&gt; 不設定B
</code></pre></div><p>而這邊不用prevState.B != this.state.B是因為會變成這樣:</p> <div class="language- extra-class"><pre><code>偵測到A被設定-&gt; 在componentDidUpdate中設定B -&gt; 偵測到B被設定 -&gt; 在componentDidUpdate中設定B -&gt; 偵測到B被設定 -&gt; 發現B的值和之前一樣 -&gt; 不設定B
</code></pre></div><p>如果你的 component 裡面有 <code>getSnapshotBeforeUpdate()</code> 這個很少見的生命週期方法，其回傳的值將會被當作第三個「snapshot」參數傳給 <code>componentDidUpdate()</code>。否則這個參數會是 undefined。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>如果 shouldComponentUpdate() 回傳的值為 false 的話，componentDidUpdate() 將不會被呼叫。</p></div> <h3 id="componentwillunmount"><a href="#componentwillunmount" class="header-anchor">#</a> componentWillUnmount()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>componentWillUnmount()</code> 會在ㄧ個 component 被 unmount 和 destroy 後馬上被呼叫。你可以在這個方法內進行任何清理，像是取消計時器和網路請求或是移除任何在 <code>componentDidMount()</code> 內建立的 subscription。</p> <p>你<strong>不應該在 componentWillUnmount() 內呼叫 setState()</strong>，因為這個 component 永遠不會再重新 render。當一個 component instance 被 unmount 後，它就永遠不會再被 mount。</p> <h2 id="不常使用的生命週期方法"><a href="#不常使用的生命週期方法" class="header-anchor">#</a> 不常使用的生命週期方法</h2> <p>這個章節內介紹的方法是在那些不常見的情況中使用的。它們有時很方便，但是你大多數的 component 大概不會需要使用它們。</p> <h3 id="shouldcomponentupdate"><a href="#shouldcomponentupdate" class="header-anchor">#</a> shouldComponentUpdate()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>你可以使用 <code>shouldComponentUpdate()</code> 來讓 React 知道一個 component 的 output 並不會被目前在 state 或 prop 內的改變所影響。React 的預設行為是每當 state 有所改變時就重新 render。在絕大多數的情況下，你應該依賴這個預設行為。</p> <p><code>shouldComponentUpdate()</code> 會在新的 prop 或 state 被接收之後並在該 component 被 render 之前被呼叫。其預設值是 <code>true</code>。這個方法並不會 component 初次 render 時或使用 forceUpdate() 時被呼叫。</p> <p>這個方法的存在著要是為了 效能最佳化。請不要依賴這個方法來「避免」 render，因為這很有可能會導致 bug。請考慮使用 React 內建的 <code>PureComponent</code> 並避免手寫 <code>shouldComponentUpdate()</code>。<code>PureComponent</code> 會為 prop 和 state 做一個淺層比較（shallow comparison）並減低你錯過必要更新的機會。</p> <p>如果你很確定你想要手寫這個方法的話，你可以將 <code>this.props</code> 和 <code>nextProps</code> 以及 <code>this.state</code> 和 <code>nextState</code> 做比較並回傳 <code>false</code> 以告知 React 這次的更新可以被略過。請注意，回傳 <code>false</code> 並不會避免 child component 在它們的 state 改變時重新 render。</p> <p>我們並不建議你做深度比較（deep equality check）或在 <code>shouldComponentUpdate()</code> 內使用 <code>JSON.stringify()</code>。它們效率不佳且會造成效能問題。</p> <p>目前，如果 <code>shouldComponentUpdate()</code> 回傳 <code>false</code> 的話，<code>UNSAFE_componentWillUpdate()</code>、<code>render()</code> 和 <code>componentDidUpdate()</code> 都不會被呼叫。在未來，React 可能會把 <code>shouldComponentUpdate()</code> 當作一個提示而非一個嚴格指令，而回傳 <code>false</code> 可能還是會造成 component 重新 render。</p> <h3 id="static-getderivedstatefromprops"><a href="#static-getderivedstatefromprops" class="header-anchor">#</a> static getDerivedStateFromProps()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>getDerivedStateFromProps</code> 會在一個 component 被 render 前被呼叫，不管是在首次 mount 時或後續的更新時。它應該回傳一個 object 以更新 state，或回傳 <code>null</code> 以表示不需要更新任何 state。</p> <p>這個方法是為了某些很少見的例子而存在的，像是有時 state 會依賴 prop 在一段時間過後所產生的改變。例如，也許建立一個 <code>&lt;Transition&gt;</code>component 是很方便的，我們可以用它來比較其之前與之後的 children，並決定我們要 animate in and out 哪一個 child。</p> <p>繼承 state 會導致冗長的程式碼並使你的 component 很難理解。<a href="https://zh-hant.reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="noopener noreferrer">請確認你知道這些較為簡單的替代方案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <ul><li>如果你需要在某個 prop 改變時產生相對應的<strong>side effect</strong>（例如，資料提取或使用動畫），請使用 componentDidUpdate。</li> <li>如果你想要 <strong>在某個 prop 改變時重新計算某些資料</strong>，請使用 memoization helper。</li> <li>如果你想要 <strong>在某個 prop 改變時「重置」某個 state</strong>，請考慮建立一個完全被控制 的 component 或帶有 key 的完全不可被控制 component。</li></ul> <p>這個方法無法觸及一個 component 的 instance。如果你想要這麼做的話，你可以把一個 component 的 prop 和 state 提取出來變成 pure function，並寫在該 class definition 之外，並透過這樣的方式在 <code>getDerivedStateFromProps()</code>和其他 class 方法之間重複使用某些程式碼。</p> <p>請注意這個方法在每一次 render 時都會被觸發，不論原因為何。這和 <code>UNSAFE_componentWillReceiveProps</code> 有所不同，這個方法只有在 parent 導致重新 render 時被觸發，而非在本地的 <code>setState</code> 導致重新 render 時被觸發。</p> <h3 id="getsnapshotbeforeupdate"><a href="#getsnapshotbeforeupdate" class="header-anchor">#</a> getSnapshotBeforeUpdate()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>getSnapshotBeforeUpdate()</code> 在提交最新 render 的 output 之前立即被調用。它讓你在 DOM 改變之前先從其中抓取一些資訊（例如滾動軸的位置）。這個生命週期方法回傳的任何值會被當作一個參數傳遞給 <code>componentDidUpdate()</code>。</p> <p>這個方法並不常見，但它可能會在像是對話串這類需要以某種特殊方始處理滾動軸位置的 UI 中出現。</p> <p>一個 snapshot 的值（或 <code>null</code>）應該被回傳。</p> <p>例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ScrollingList</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>listRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Are we adding new items to the list?</span>
    <span class="token comment">// Capture the scroll position so we can adjust scroll later.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prevProps<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
            <span class="token keyword">return</span> list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> list<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If we have a snapshot value, we've just added new items.</span>
        <span class="token comment">// Adjust scroll so these new items don't push the old ones out of view.</span>
        <span class="token comment">// (snapshot here is the value returned from getSnapshotBeforeUpdate)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>snapshot <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">.</span>current<span class="token punctuation">;</span>
            list<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> list<span class="token punctuation">.</span>scrollHeight <span class="token operator">-</span> snapshot<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>listRef<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token comment">/* ...contents... */</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>在上面這個例子中，讀取 <code>getSnapshotBeforeUpdate</code> 內的 <code>scrollHeight</code> property 是很重要的，因為「render」階段的生命週期方法（如 <code>render</code>）和「commit」階段的生命週期方法（像是 <code>getSnapshotBeforeUpdate</code> 和 <code>componentDidUpdate</code>）兩者之間可能會有一些延遲。</p> <h2 id="實例"><a href="#實例" class="header-anchor">#</a> 實例:</h2> <h3 id="mounting-元件被安裝時-2"><a href="#mounting-元件被安裝時-2" class="header-anchor">#</a> Mounting 元件被安裝時</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Tzuyu</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token comment">// 如果不寫props, 下面就會打印undefined</span>
        <span class="token comment">// console.log(this.props,'props');</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. constructor執行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根據父級傳遞的參數來更新state</span>
    <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2. getDerivedStateFromProps執行 =&gt; props數據:'</span><span class="token punctuation">,</span>props<span class="token punctuation">,</span> <span class="token string">&quot;state數據:&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> props<span class="token punctuation">.</span>age<span class="token punctuation">}</span>
        <span class="token comment">// return null 不想設置就回傳null</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span>age<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3. render執行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>一代元件<span class="token operator">--</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 安裝完成之後執行</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'4. componentDidMount, 元件安裝完成觸發, 在render之後'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Tzuyu age<span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">18</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>控制台輸出:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.</span> constructor執行
<span class="token number">2.</span> <span class="token parameter">getDerivedStateFromProps執行</span> <span class="token operator">=&gt;</span> props數據<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">}</span> state數據<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
<span class="token number">3.</span> render執行
<span class="token number">4.</span> componentDidMount<span class="token punctuation">,</span> 元件安裝完成觸發<span class="token punctuation">,</span> 在render之後
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="updating-元件被更新時-2"><a href="#updating-元件被更新時-2" class="header-anchor">#</a> Updating 元件被更新時</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Tzuyu</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'12'</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 根據父級傳遞的參數來更新state</span>
    <span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. getDerivedStateFromProps執行 =&gt; props數據:'</span><span class="token punctuation">,</span> props<span class="token punctuation">,</span> <span class="token string">&quot;state數據:&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> state<span class="token punctuation">.</span>age <span class="token punctuation">}</span>
        <span class="token comment">// return null 不想設置就回傳null</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 守門員，用來做確認是不是真的要update</span>
    <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span><span class="token parameter">nextProps<span class="token punctuation">,</span> nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;2. nextProps: &quot;</span><span class="token punctuation">,</span> nextProps<span class="token punctuation">,</span> <span class="token string">&quot;nextState: &quot;</span><span class="token punctuation">,</span> nextState<span class="token punctuation">,</span> <span class="token string">'設置類元件是否允許頁面更新'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token comment">// 要return一個布林值。當函數回傳false時，元件就不會更新，也不會繼續執行接下來的render()以及剩下的update生命週期函數。預設會回傳true。</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 更改state數據 觸發更新效果</span>
    <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>age
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3. render執行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span><span class="token operator">&gt;</span>點點<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提交虛擬DOM至頁面前執行, (渲染輸出前執行)</span>
    <span class="token function">getSnapshotBeforeUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 獲取更新之前的數據</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;4. prevProps: &quot;</span><span class="token punctuation">,</span> prevProps<span class="token punctuation">,</span> <span class="token string">&quot;prevState: &quot;</span><span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> <span class="token string">'渲染輸出前執行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'你好呀'</span> <span class="token punctuation">}</span> <span class="token comment">// 這個值將作為 snapshot的實參 傳遞給 componentDidUpdate</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 唯一也是最後在DOM真的被更新後執行的週期函數。</span>
    <span class="token comment">// 只要任何一個props/state被設定(assign)，就會重新進入Update週期，導致此函數再次被執行</span>
    <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token parameter">prevProps<span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> snapshot</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// snapshot是getSnapshotBeforeUpdate傳來的參數</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;5. prevProps: &quot;</span><span class="token punctuation">,</span> prevProps<span class="token punctuation">,</span> <span class="token string">&quot;prevState&quot;</span><span class="token punctuation">,</span> prevState<span class="token punctuation">,</span> <span class="token string">&quot;snapshot&quot;</span><span class="token punctuation">,</span> snapshot<span class="token punctuation">,</span> <span class="token string">'   更新頁面之後觸發'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Tzuyu name<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'子子'</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>點擊button觸發更新後, 控制台輸出:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1.</span> <span class="token parameter">getDerivedStateFromProps執行</span> <span class="token operator">=&gt;</span> props數據<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'子子'</span><span class="token punctuation">}</span> state數據<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span>
<span class="token number">2.</span> <span class="token literal-property property">nextProps</span><span class="token operator">:</span>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'子子'</span><span class="token punctuation">}</span> nextState<span class="token operator">:</span>  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span> 設置類元件是否允許頁面更新
<span class="token number">3.</span> render執行
<span class="token number">4.</span> <span class="token literal-property property">prevProps</span><span class="token operator">:</span>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'子子'</span><span class="token punctuation">}</span> prevState<span class="token operator">:</span>  <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span> 渲染輸出前執行
<span class="token number">5.</span> <span class="token literal-property property">prevProps</span><span class="token operator">:</span>  <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'子子'</span><span class="token punctuation">}</span> prevState <span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">}</span> snapshot <span class="token punctuation">{</span><span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">'你好呀'</span><span class="token punctuation">}</span>    更新畫面之後觸發
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="unmounting-元件被移除時-2"><a href="#unmounting-元件被移除時-2" class="header-anchor">#</a> Unmounting 元件被移除時</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Tzuyu</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span><span class="token punctuation">{</span>
    <span class="token comment">// componentDidMount 和 componentWillUnmount 經常搭配使用</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;子瑜來了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'子瑜不在子瑜不在'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>子瑜來了<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 父元件</span>
<span class="token keyword">class</span> <span class="token class-name">Member</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">bol</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
    <span class="token function-variable function">change</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">bol</span><span class="token operator">:</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>bol<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>bol<span class="token operator">?</span> <span class="token operator">&lt;</span>Tzuyu <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token operator">:</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>子瑜不在子瑜不在<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
                <span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span><span class="token operator">&gt;</span>點點<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Member <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>效果:
<img src="/blog/assets/img/tzuyucome.ed87fee3.gif" alt="子瑜來去之間"></p> <h4 id="移除監聽事件"><a href="#移除監聽事件" class="header-anchor">#</a> 移除監聽事件</h4> <p>監聽事件也是我們很常對DOM做的操作，假使我們今天是這樣監聽視窗的點擊事件:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">IWasClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;啊!我被點了!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IWasClick<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我們就要這樣避免重複監聽:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>IWasClick<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.aecd4755.js" defer></script><script src="/blog/assets/js/2.8521d118.js" defer></script><script src="/blog/assets/js/10.366d327b.js" defer></script>
  </body>
</html>
